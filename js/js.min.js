function initHooks(){var a=$(document);a.on("click",".sensor-unit-link",toggleSensorUnit)}function getDate(a){return a=""+a,a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2)}function isFunction(a){var b={};return a&&b.toString.call(a)=="[object Function]"}function getUniqueID(a,b){return a*20+b}function formatReadings(a){var b=[],c=[];$.each(a,function(a,c){var d=getUniqueID(c.sensor_id,c.unit_id),e=[],f=(new Date("2012-03-22")).valueOf()+c.time_id*1e3;typeof b[d]=="undefined"&&(b[d]={label:sensors[c.sensor_id]+c.unit_id,data:[],hoverable:!0}),e=[f,c.value],b[d].data.push(e)});for(var d in b)c.push(b[d]);return c}function getLReading(a){if(!a)return!1;getREST("LReadings",a,function(a){var b=formatReadings(a.data);plot=$.plot($("#graph0"),b,plotOptions)})}function initTooltips(){$(".sensor-name").each(function(a,b){var c=$(this).find(".tooltip-content").html(),d=$(this).find("a").text();$(this).popover({content:c,title:d})})}function toggleSensorUnit(){var a=$(this),b=a.find(".label"),c=a.data("unit-id"),d=a.data("sensor-id"),e=getUniqueID(d,c),f=[];b.hasClass("label-success")?b.text("Off"):b.text("On"),activeUnits[e]?delete activeUnits[e]:activeUnits[e]={unit_id:c,sensor_id:d};for(var g in activeUnits)f.push(activeUnits[g]);getLReading(f),b.toggleClass("label-success")}function init(){getREST("Sensors",function(a){$.each(a.data,function(a,b){sensors[b.sensor_id]=b.sensor_user_name}),$("#senzori").handlebars($("#sensorTmpl"),a),initTooltips()}),initHooks()}function getREST(a,b,c){isFunction(b)?$.ajax(apiUrl+a+"/",{success:b,type:"GET"}):$.ajax(apiUrl+a+"/search",{success:c,type:"POST",data:JSON.stringify(b),processData:!1})}(function(a){var b={};a.fn.handlebars=function(c,d){c instanceof jQuery&&(c=a(c).html()),b[c]=Handlebars.compile(c),this.html(b[c](d))}})(jQuery);var hostname=document.location.hostname,apiUrl="http://"+hostname+"/~josip/zavrsni/zavrsni/index.php/api/",plot,sensors=[],activeUnits=[],plotOptions={series:{lines:{show:!0},points:{show:!1}},crosshair:{mode:"x"},xaxis:{mode:"time"}};$(init)